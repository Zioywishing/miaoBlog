const e=new DOMParser,t=t=>{let n=e.parseFromString(t,`text/html`).children[0].children[1].children[0];return n.style.width=`17px`,n},n=()=>{let e=t(`<span><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512"><path d="M465.94 119.76l-73.7-73.7A47.68 47.68 0 0 0 358.3 32H96a64 64 0 0 0-64 64v320a64 64 0 0 0 64 64h320a64 64 0 0 0 64-64V153.7a47.68 47.68 0 0 0-14.06-33.94zM120 112h176a8 8 0 0 1 8 8v48a8 8 0 0 1-8 8H120a8 8 0 0 1-8-8v-48a8 8 0 0 1 8-8zm139.75 319.91a80 80 0 1 1 76.16-76.16a80.06 80.06 0 0 1-76.16 76.16z" fill="currentColor"></path><circle cx="256" cy="352" r="48" fill="currentColor"></circle></svg></span>`);return e.style.transform=`translateY(3px)`,e},r=()=>{let e=t(`<span>
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512"><path d="M336 176h40a40 40 0 0 1 40 40v208a40 40 0 0 1-40 40H136a40 40 0 0 1-40-40V216a40 40 0 0 1 40-40h40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M176 272l80 80l80-80"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 48v288"></path></svg>
    </span>`);return e.style.transform=`translateY(2px) scale(1.1)`,e},i=()=>{let e=t(`<span><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none"><path d="M19.25 2a.75.75 0 0 0-.743.648l-.007.102v5.69l-4.574-4.56a6.41 6.41 0 0 0-8.878-.179l-.186.18a6.41 6.41 0 0 0 0 9.063l8.845 8.84a.75.75 0 0 0 1.06-1.062l-8.845-8.838a4.91 4.91 0 0 1 6.766-7.112l.178.17L17.438 9.5H11.75a.75.75 0 0 0-.743.648L11 10.25c0 .38.282.694.648.743l.102.007h7.5a.75.75 0 0 0 .743-.648L20 10.25v-7.5a.75.75 0 0 0-.75-.75z" fill="currentColor"></path></g></svg></span>`);return e.style.transform=`translateY(3px)`,e},a=()=>{let e=t(`<span><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none"><path d="M4.75 2a.75.75 0 0 1 .743.648l.007.102v5.69l4.574-4.56a6.41 6.41 0 0 1 8.879-.179l.186.18a6.41 6.41 0 0 1 0 9.063l-8.846 8.84a.75.75 0 0 1-1.06-1.062l8.845-8.838a4.91 4.91 0 0 0-6.766-7.112l-.178.17L6.562 9.5h5.688a.75.75 0 0 1 .743.648l.007.102a.75.75 0 0 1-.648.743L12.25 11h-7.5a.75.75 0 0 1-.743-.648L4 10.25v-7.5A.75.75 0 0 1 4.75 2z" fill="currentColor"></path></g></svg></span>`);return e.style.transform=`translateY(3px)`,e};var o=class{db=null;config;initPromise=null;constructor(e){this.config={version:1,...e}}async init(){if(!this.db)return this.initPromise||=new Promise((e,t)=>{let n=indexedDB.open(this.config.name,this.config.version);n.onerror=()=>{this.initPromise=null,t(n.error)},n.onsuccess=()=>{this.db=n.result,e()},n.onupgradeneeded=e=>{let t=e.target.result;this.config.stores.forEach(e=>{if(!t.objectStoreNames.contains(e.name)){let n=t.createObjectStore(e.name,{keyPath:e.keyPath});e.indexes&&e.indexes.forEach(e=>{n.createIndex(e.name,e.keyPath,{unique:e.unique||!1})})}})}}),this.initPromise}async ensureDB(){this.db||await this.init()}async put(e,t){return await this.ensureDB(),new Promise((n,r)=>{let i=this.db.transaction([e],`readwrite`),a=i.objectStore(e),o=a.put(t);o.onsuccess=()=>n(),o.onerror=()=>r(o.error)})}async add(e,t){return await this.ensureDB(),new Promise((n,r)=>{let i=this.db.transaction([e],`readwrite`),a=i.objectStore(e),o=a.add(t);o.onsuccess=()=>n(),o.onerror=()=>r(o.error)})}async get(e,t){return await this.ensureDB(),new Promise((n,r)=>{let i=this.db.transaction([e],`readonly`),a=i.objectStore(e),o=a.get(t);o.onsuccess=()=>n(o.result||null),o.onerror=()=>r(o.error)})}async query(e,t={}){return await this.ensureDB(),new Promise((n,r)=>{let i=this.db.transaction([e],`readonly`),a=i.objectStore(e),o=a;t.index&&(o=a.index(t.index));let s=o.openCursor(t.range,t.direction),c=[],l=0;s.onsuccess=e=>{let r=e.target.result;r&&(!t.limit||l<t.limit)?(c.push(r.value),l++,r.continue()):n(c)},s.onerror=()=>r(s.error)})}async getAll(e){return await this.ensureDB(),new Promise((t,n)=>{let r=this.db.transaction([e],`readonly`),i=r.objectStore(e),a=i.getAll();a.onsuccess=()=>t(a.result),a.onerror=()=>n(a.error)})}async delete(e,t){return await this.ensureDB(),new Promise((n,r)=>{let i=this.db.transaction([e],`readwrite`),a=i.objectStore(e),o=a.delete(t);o.onsuccess=()=>n(),o.onerror=()=>r(o.error)})}async clear(e){return await this.ensureDB(),new Promise((t,n)=>{let r=this.db.transaction([e],`readwrite`),i=r.objectStore(e),a=i.clear();a.onsuccess=()=>t(),a.onerror=()=>n(a.error)})}async count(e,t){return await this.ensureDB(),new Promise((n,r)=>{let i=this.db.transaction([e],`readonly`),a=i.objectStore(e),o=a.count(t);o.onsuccess=()=>n(o.result),o.onerror=()=>r(o.error)})}close(){this.db&&(this.db.close(),this.db=null)}static async deleteDatabase(e){return new Promise((t,n)=>{let r=indexedDB.deleteDatabase(e);r.onsuccess=()=>t(),r.onerror=()=>n(r.error),r.onblocked=()=>n(Error(`Database deletion blocked`))})}},s=o;const c=30,l=e=>{let t=-1,n=[],r=!1,i=null,a=new s({name:`MindElixirHistory`,version:1,stores:[{name:`history`,keyPath:`timestamp`},{name:`historyIndex`,keyPath:`id`}]}),o=async()=>{let e=await a.get(`historyIndex`,1);return e||{id:1,timestamps:[],currentIndex:-1}},l=async e=>{await a.put(`historyIndex`,e)},u=async()=>{if(!r)return i||(i=(async()=>{try{await a.init();let e=await o();n=e.timestamps,t=e.currentIndex,r=!0}catch(e){throw i=null,e}})(),i)},d=async e=>{await a.put(`history`,e)},f=async e=>await a.get(`history`,e),p=async e=>{await a.delete(`history`,e)},m=async()=>{if(e.value)try{await u();let r=e.value.getData(),i=Date.now(),a=n.slice(0,t+1);for(let e=t+1;e<n.length;e++)await p(n[e]);for(a.push(i);a.length>c;){let e=a.shift();await p(e)}await d({timestamp:i,data:r}),n=a,t=n.length-1,await l({id:1,timestamps:n,currentIndex:t})}catch(e){console.error(`Failed to record mind map image:`,e)}},h=async()=>{if(e.value)try{if(await u(),t<=0)return;t--;let r=n[t],i=await f(r);i&&(e.value.refresh(i.data),await l({id:1,timestamps:n,currentIndex:t}))}catch(e){console.error(`Failed to undo history:`,e)}},g=async()=>{if(e.value)try{if(await u(),t>=n.length-1)return;t++;let r=n[t],i=await f(r);i&&(e.value.refresh(i.data),await l({id:1,timestamps:n,currentIndex:t}))}catch(e){console.error(`Failed to redo history:`,e)}},_=async()=>{if(e.value)try{if(await u(),t<0)return;let e=n[t],r=await f(e);if(r)return r.data}catch(e){console.error(`Failed to get current history:`,e)}};return{recordMindMapImage:m,undoHistory:h,redoHistory:g,getCurrentHistory:_}};var u=l;export{u as b,r as c,i as d,n as e,a as f};